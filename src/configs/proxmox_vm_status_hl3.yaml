source: proxmox
entity: vm_status
schema_version: 1

collect:
  mode: loop
  node: hl3

  # Fetch only QEMU VMs
  list_endpoint: "/api2/json/nodes/{node}/qemu"
  list_json_path: "data"
  id_field: "vmid"
  
  # {id} is the vmid (e.g. 103)
  # {node} comes from the variable defined above
  item_endpoint_template: "/api2/json/nodes/{node}/qemu/{id}/status/current"

http:
  # {node} is replaced by "hl4" automatically
  base_url: "https://{node}.d.mckaylab.me:8006"
  verify_tls: false
  timeout_seconds: 20

auth:
  mode: proxmox_token
  token_id_env: "PROXMOX_API_TOKEN_ID"
  # {NODE} is automatically available as the uppercase version (HL4)
  token_secret_env: "PROXMOX_API_TOKEN_SECRET_{NODE}"

storage:
  container_env: "AZURE_BLOB_CONTAINER"
  container_default: "homelab-telemetry"
  bronze_prefix: "bronze"
  system: "proxmox"
  dataset: "vm_status"

schedule:
  interval_seconds: 60